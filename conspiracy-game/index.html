<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Conspiracy Theory Game — Braeden Pope</title>
  <meta name="description" content="Play the Waterdeep Conspiracy Theory Game - A fun D&D campaign game." />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Import medieval-style fonts */
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cinzel+Decorative:wght@400;700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap');
    
    :root {
      --parchment: #f4e4bc;
      --dark-parchment: #e6d3a7;
      --medieval-brown: #8b4513;
      --deep-brown: #5d2f0a;
      --gold: #daa520;
      --dark-gold: #b8860b;
      --crimson: #8b0000;
      --dark-crimson: #660000;
      --forest-green: #228b22;
      --stone-gray: #696969;
      --dark-stone: #2f2f2f;
      --leather: #654321;
      --iron: #708090;
    }

    body {
      background: 
        radial-gradient(circle at 20% 80%, rgba(139, 69, 19, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(139, 0, 0, 0.2) 0%, transparent 50%),
        linear-gradient(135deg, #2c1810 0%, #1a0f08 100%);
      background-attachment: fixed;
    }

    .game-container {
      max-width: 1200px;
      width: 100%;
      padding: 20px;
      text-align: center;
      margin: 0 auto;
      background: 
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(139, 69, 19, 0.03) 2px,
          rgba(139, 69, 19, 0.03) 4px
        );
    }

    .game-title {
      font-family: 'Cinzel Decorative', serif;
      font-size: 2.8em;
      margin-bottom: 30px;
      color: var(--gold);
      text-shadow: 
        2px 2px 4px rgba(0,0,0,0.8),
        0 0 10px rgba(218, 165, 32, 0.3);
      font-weight: 700;
      letter-spacing: 2px;
    }

    .screen {
      display: none;
      animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      background: 
        radial-gradient(ellipse at center, rgba(244, 228, 188, 0.05) 0%, transparent 70%);
      border-radius: 20px;
      padding: 20px;
      border: 2px solid rgba(218, 165, 32, 0.2);
    }

    .screen.active {
      display: block;
    }

    .screen.exiting {
      animation: slideOut 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideIn {
      from { 
        opacity: 0; 
        transform: translateX(50px) scale(0.95);
        filter: blur(5px);
      }
      to { 
        opacity: 1; 
        transform: translateX(0) scale(1);
        filter: blur(0);
      }
    }

    @keyframes slideOut {
      from { 
        opacity: 1; 
        transform: translateX(0) scale(1);
        filter: blur(0);
      }
      to { 
        opacity: 0; 
        transform: translateX(-50px) scale(0.95);
        filter: blur(5px);
      }
    }

    .transition-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 30% 70%, rgba(139, 0, 0, 0.2) 0%, transparent 50%),
        radial-gradient(circle at 70% 30%, rgba(139, 69, 19, 0.2) 0%, transparent 50%),
        rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
    }

    .transition-overlay.active {
      display: flex;
      animation: fadeIn 0.3s ease-in-out;
    }

    .transition-text {
      font-family: 'Cinzel', serif;
      font-size: 1.5em;
      color: var(--gold);
      text-align: center;
      background: 
        linear-gradient(135deg, rgba(139, 69, 19, 0.9) 0%, rgba(93, 47, 10, 0.9) 100%);
      padding: 25px 45px;
      border-radius: 15px;
      border: 3px solid var(--gold);
      box-shadow: 
        0 0 20px rgba(218, 165, 32, 0.3),
        inset 0 1px 0 rgba(244, 228, 188, 0.2);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }

    .screen-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 3px solid rgba(218, 165, 32, 0.4);
      background: 
        linear-gradient(90deg, transparent 0%, rgba(139, 69, 19, 0.1) 50%, transparent 100%);
    }

    .screen-title {
      font-family: 'Cinzel', serif;
      font-size: 2.2em;
      margin-bottom: 10px;
      color: var(--gold);
      font-weight: 600;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
    }

    .screen-subtitle {
      font-family: 'Libre Baskerville', serif;
      font-size: 1.1em;
      color: var(--dark-parchment);
      font-style: italic;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(139, 69, 19, 0.3);
      border-radius: 4px;
      margin: 20px 0;
      overflow: hidden;
      border: 1px solid rgba(218, 165, 32, 0.3);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--gold) 0%, var(--crimson) 50%, var(--gold) 100%);
      border-radius: 4px;
      transition: width 0.6s ease;
      box-shadow: 0 0 5px rgba(218, 165, 32, 0.5);
    }

    .lobby-code {
      font-family: 'Cinzel', serif;
      font-size: 3.5em;
      background: 
        linear-gradient(135deg, rgba(139, 69, 19, 0.4) 0%, rgba(93, 47, 10, 0.4) 100%);
      padding: 25px;
      border-radius: 20px;
      margin: 20px 0;
      border: 3px solid var(--gold);
      font-weight: 700;
      letter-spacing: 0.3em;
      color: var(--gold);
      text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
      box-shadow: 
        0 5px 15px rgba(0,0,0,0.5),
        inset 0 1px 0 rgba(244, 228, 188, 0.2);
    }

    .players-list {
      background: 
        linear-gradient(135deg, rgba(139, 69, 19, 0.3) 0%, rgba(93, 47, 10, 0.3) 100%);
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      min-height: 150px;
      border: 2px solid rgba(218, 165, 32, 0.4);
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
    }

    .players-list h3 {
      font-family: 'Cinzel', serif;
      color: var(--gold);
      margin-bottom: 15px;
    }

    .player-item {
      background: 
        linear-gradient(135deg, rgba(218, 165, 32, 0.3) 0%, rgba(184, 134, 11, 0.3) 100%);
      margin: 10px;
      padding: 15px 20px;
      border-radius: 12px;
      display: inline-block;
      min-width: 150px;
      border: 2px solid rgba(218, 165, 32, 0.5);
      box-shadow: 
        0 3px 8px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(244, 228, 188, 0.2);
      font-family: 'Libre Baskerville', serif;
      color: var(--parchment);
      font-weight: bold;
    }

    .prompt-display {
      background: 
        linear-gradient(135deg, rgba(139, 69, 19, 0.4) 0%, rgba(93, 47, 10, 0.4) 100%);
      border-radius: 20px;
      padding: 35px;
      margin: 20px 0;
      font-size: 1.4em;
      line-height: 1.6;
      border: 3px solid rgba(218, 165, 32, 0.5);
      font-family: 'Libre Baskerville', serif;
      color: var(--parchment);
      text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
      box-shadow: 
        0 8px 20px rgba(0,0,0,0.4),
        inset 0 2px 0 rgba(244, 228, 188, 0.1);
      position: relative;
    }

    .prompt-display::before {
      content: '"';
      font-size: 4em;
      position: absolute;
      top: -10px;
      left: 15px;
      color: var(--gold);
      opacity: 0.3;
      font-family: 'Cinzel Decorative', serif;
    }

    .prompt-display::after {
      content: '"';
      font-size: 4em;
      position: absolute;
      bottom: -30px;
      right: 15px;
      color: var(--gold);
      opacity: 0.3;
      font-family: 'Cinzel Decorative', serif;
    }

    .timer {
      font-family: 'Cinzel', serif;
      font-size: 2.5em;
      color: var(--crimson);
      margin: 20px 0;
      font-weight: bold;
      text-shadow: 
        0 0 10px rgba(139, 0, 0, 0.8),
        2px 2px 4px rgba(0,0,0,0.8);
    }

    .timer.warning {
      animation: medievalPulse 1s infinite;
      color: #ff4757;
      text-shadow: 
        0 0 20px rgba(255, 71, 87, 0.8),
        2px 2px 4px rgba(0,0,0,0.8);
    }

    @keyframes medievalPulse {
      0%, 100% { 
        opacity: 1; 
        transform: scale(1);
      }
      50% { 
        opacity: 0.6; 
        transform: scale(1.05);
      }
    }

    .answers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .answer-item {
      background: 
        linear-gradient(135deg, rgba(139, 69, 19, 0.4) 0%, rgba(93, 47, 10, 0.4) 100%);
      border-radius: 15px;
      padding: 25px;
      border: 2px solid rgba(218, 165, 32, 0.3);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      font-family: 'Libre Baskerville', serif;
      color: var(--parchment);
      box-shadow: 
        0 4px 12px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(244, 228, 188, 0.1);
    }

    .answer-item:hover {
      border-color: var(--gold);
      transform: translateY(-3px) scale(1.02);
      background: 
        linear-gradient(135deg, rgba(218, 165, 32, 0.2) 0%, rgba(139, 69, 19, 0.4) 100%);
      box-shadow: 
        0 8px 25px rgba(218, 165, 32, 0.3),
        inset 0 2px 0 rgba(244, 228, 188, 0.2);
    }

    .answer-item.voted {
      border-color: var(--forest-green);
      background: 
        linear-gradient(135deg, rgba(34, 139, 34, 0.3) 0%, rgba(139, 69, 19, 0.4) 100%);
      box-shadow: 
        0 6px 18px rgba(34, 139, 34, 0.3),
        inset 0 2px 0 rgba(244, 228, 188, 0.2);
    }

    .answer-item.non-clickable {
      cursor: default;
    }

    .vote-count {
      font-family: 'Cinzel', serif;
      font-size: 1.8em;
      color: var(--gold);
      font-weight: bold;
      margin-top: 15px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }

    .game-btn {
      background: 
        linear-gradient(135deg, var(--gold) 0%, var(--dark-gold) 100%);
      color: var(--deep-brown);
      border: 3px solid var(--medieval-brown);
      padding: 15px 35px;
      border-radius: 25px;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      margin: 10px;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-family: 'Cinzel', serif;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      box-shadow: 
        0 4px 12px rgba(0,0,0,0.4),
        inset 0 2px 0 rgba(244, 228, 188, 0.3);
    }

    .game-btn:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 
        0 8px 20px rgba(218, 165, 32, 0.4),
        inset 0 2px 0 rgba(244, 228, 188, 0.4);
      background: 
        linear-gradient(135deg, #f4d03f 0%, var(--gold) 100%);
    }

    .game-btn:disabled {
      background: linear-gradient(135deg, var(--stone-gray) 0%, var(--dark-stone) 100%);
      color: var(--dark-parchment);
      cursor: not-allowed;
      transform: none;
      box-shadow: 
        0 2px 6px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.1);
      opacity: 0.6;
    }

    .game-btn.success {
      background: 
        linear-gradient(135deg, var(--forest-green) 0%, #32cd32 100%);
      color: var(--parchment);
      border-color: var(--forest-green);
    }

    .input-field {
      padding: 15px 20px;
      border-radius: 12px;
      border: 3px solid var(--medieval-brown);
      background: 
        linear-gradient(135deg, rgba(244, 228, 188, 0.1) 0%, rgba(139, 69, 19, 0.1) 100%);
      color: var(--parchment);
      font-size: 1.2em;
      margin: 10px;
      width: 300px;
      transition: all 0.3s ease;
      font-family: 'Libre Baskerville', serif;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }

    .input-field:focus {
      outline: none;
      border-color: var(--gold);
      background: 
        linear-gradient(135deg, rgba(244, 228, 188, 0.2) 0%, rgba(218, 165, 32, 0.1) 100%);
      box-shadow: 
        0 0 15px rgba(218, 165, 32, 0.3),
        inset 0 2px 5px rgba(0,0,0,0.2);
    }

    .input-field::placeholder {
      color: rgba(244, 228, 188, 0.6);
      font-style: italic;
    }

    .scoreboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }

    .score-item {
      background: 
        linear-gradient(135deg, rgba(139, 69, 19, 0.4) 0%, rgba(93, 47, 10, 0.4) 100%);
      border-radius: 15px;
      padding: 25px;
      border: 3px solid var(--gold);
      position: relative;
      font-family: 'Libre Baskerville', serif;
      color: var(--parchment);
      box-shadow: 
        0 6px 18px rgba(0,0,0,0.4),
        inset 0 2px 0 rgba(244, 228, 188, 0.2);
    }

    .score-item.winner {
      border-color: var(--forest-green);
      background: 
        linear-gradient(135deg, rgba(34, 139, 34, 0.4) 0%, rgba(139, 69, 19, 0.4) 100%);
      box-shadow: 
        0 8px 25px rgba(34, 139, 34, 0.4),
        inset 0 2px 0 rgba(244, 228, 188, 0.3);
    }

    .score-item.winner::before {
      content: "👑";
      position: absolute;
      top: -15px;
      right: -10px;
      font-size: 2.5em;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
    }

    .score-name {
      font-family: 'Cinzel', serif;
      font-size: 1.4em;
      margin-bottom: 12px;
      font-weight: bold;
      color: var(--gold);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
    }

    .score-points {
      font-family: 'Cinzel', serif;
      font-size: 2.2em;
      color: var(--crimson);
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }

    .mobile-input {
      width: 100%;
      max-width: 550px;
      margin: 20px auto;
    }

    .mobile-input textarea {
      width: 100%;
      padding: 20px;
      border-radius: 15px;
      border: 3px solid var(--medieval-brown);
      background: 
        linear-gradient(135deg, rgba(244, 228, 188, 0.1) 0%, rgba(139, 69, 19, 0.1) 100%);
      color: var(--parchment);
      font-size: 1.2em;
      resize: vertical;
      min-height: 120px;
      font-family: 'Libre Baskerville', serif;
      line-height: 1.5;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }

    .mobile-input textarea:focus {
      outline: none;
      border-color: var(--gold);
      background: 
        linear-gradient(135deg, rgba(244, 228, 188, 0.2) 0%, rgba(218, 165, 32, 0.1) 100%);
      box-shadow: 
        0 0 15px rgba(218, 165, 32, 0.3),
        inset 0 2px 5px rgba(0,0,0,0.2);
    }

    .mobile-input textarea::placeholder {
      color: rgba(244, 228, 188, 0.6);
      font-style: italic;
    }

    .status-message {
      background: 
        linear-gradient(135deg, rgba(34, 139, 34, 0.3) 0%, rgba(139, 69, 19, 0.2) 100%);
      border: 2px solid var(--forest-green);
      border-radius: 12px;
      padding: 18px;
      margin: 15px 0;
      color: var(--forest-green);
      font-family: 'Libre Baskerville', serif;
      box-shadow: 
        0 4px 12px rgba(34, 139, 34, 0.2),
        inset 0 1px 0 rgba(244, 228, 188, 0.1);
    }

    .error-message {
      background: 
        linear-gradient(135deg, rgba(139, 0, 0, 0.3) 0%, rgba(139, 69, 19, 0.2) 100%);
      border: 2px solid var(--crimson);
      border-radius: 12px;
      padding: 18px;
      margin: 15px 0;
      color: #ff6b6b;
      font-family: 'Libre Baskerville', serif;
      box-shadow: 
        0 4px 12px rgba(139, 0, 0, 0.2),
        inset 0 1px 0 rgba(244, 228, 188, 0.1);
    }

    .round-info {
      background: 
        linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(93, 47, 10, 0.2) 100%);
      border-radius: 12px;
      padding: 18px;
      margin: 18px 0;
      font-size: 1.3em;
      font-family: 'Libre Baskerville', serif;
      color: var(--dark-parchment);
      border: 1px solid rgba(218, 165, 32, 0.3);
    }

    .waiting-indicator {
      display: inline-block;
      animation: medievalSpin 2s infinite linear;
      color: var(--gold);
    }

    @keyframes medievalSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Audio Controls - Only visible for host */
    .audio-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: 
        linear-gradient(135deg, rgba(139, 69, 19, 0.9) 0%, rgba(93, 47, 10, 0.9) 100%);
      padding: 10px 15px;
      border-radius: 12px;
      border: 2px solid var(--gold);
      display: none;
      align-items: center;
      gap: 10px;
      box-shadow: 
        0 4px 12px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(244, 228, 188, 0.2);
    }

    .audio-controls.show {
      display: flex;
    }

    .audio-btn {
      background: none;
      border: none;
      color: var(--gold);
      font-size: 1.2em;
      cursor: pointer;
      padding: 5px;
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    .audio-btn:hover {
      background: rgba(218, 165, 32, 0.2);
    }

    .volume-slider {
      width: 80px;
      height: 4px;
      background: rgba(139, 69, 19, 0.5);
      border-radius: 2px;
      outline: none;
      cursor: pointer;
    }

    .volume-slider::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      background: var(--gold);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .volume-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: var(--gold);
      border-radius: 50%;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    /* Add subtle parchment texture effect */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        repeating-linear-gradient(
          45deg,
          transparent,
          transparent 1px,
          rgba(139, 69, 19, 0.02) 1px,
          rgba(139, 69, 19, 0.02) 2px
        );
      pointer-events: none;
      z-index: -1;
    }

    /* Medieval decorative elements */
    .screen-header::after {
      content: '⚜️';
      display: block;
      font-size: 1.5em;
      margin-top: 10px;
      opacity: 0.6;
    }

    @media (max-width: 768px) {
      .game-title {
        font-size: 2em;
        margin-bottom: 20px;
      }
      
      .lobby-code {
        font-size: 2.5em;
        padding: 20px;
        letter-spacing: 0.2em;
      }
      
      .input-field {
        width: 280px;
      }
      
      .answers-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .screen-title {
        font-size: 1.8em;
      }

      .prompt-display {
        padding: 25px;
        font-size: 1.2em;
      }

      .timer {
        font-size: 2em;
      }

      .audio-controls {
        top: 10px;
        right: 10px;
        padding: 8px 12px;
      }
    }

    @media (max-width: 480px) {
      .game-title {
        font-size: 1.6em;
        margin-bottom: 15px;
      }
      
      .lobby-code {
        font-size: 2em;
        padding: 15px;
        letter-spacing: 0.15em;
      }
      
      .input-field {
        width: 90%;
        font-size: 1.1em;
      }

      .screen-title {
        font-size: 1.5em;
      }

      .game-btn {
        padding: 12px 25px;
        font-size: 1em;
      }

      .prompt-display {
        padding: 20px;
        font-size: 1.1em;
      }

      .score-item {
        padding: 20px;
      }

      .score-name {
        font-size: 1.2em;
      }

      .score-points {
        font-size: 1.8em;
      }

      .audio-controls {
        top: 5px;
        right: 5px;
        padding: 6px 10px;
        font-size: 0.9em;
      }

      .volume-slider {
        width: 60px;
      }
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav><div class="container nav-inner"><div class="brand"><a href="/">Braeden Pope</a></div><ul class="nav-links"><li><a data-page="/" href="/">Home</a></li><li><a data-page="projects" href="projects">Projects</a></li><li><a data-page="about" href="about">About</a></li>        <li><a data-page="contact" href="contact">Contact</a></li><li><a data-page="conspiracy-game.html" href="conspiracy-game.html">Game</a></li></ul></div></nav>

  <div class="container">
    <div class="game-container">
      <h1 class="game-title">🕵️ Waterdeep Conspiracy Theories 🕵️</h1>
      
      <!-- Audio Controls (Host Only) -->
      <div class="audio-controls" id="audio-controls">
        <button class="audio-btn" id="mute-btn" onclick="toggleMute()">🔊</button>
        <input type="range" class="volume-slider" id="volume-slider" min="0" max="1" step="0.1" value="0.5" 
               onchange="setGameVolume(this.value)">
        <button class="audio-btn" onclick="gameAudio.stopAll()">⏹️</button>
      </div>
      
      <!-- Transition Overlay -->
      <div class="transition-overlay" id="transition-overlay">
        <div class="transition-text" id="transition-text">Loading...</div>
      </div>
      
      <!-- Screen 1: Home Screen -->
      <div id="home-screen" class="screen active">
        <div class="screen-header">
          <div class="screen-title">Welcome to the Game!</div>
          <div class="screen-subtitle">Create wild conspiracy theories about your D&D campaign</div>
        </div>
        <div style="margin-bottom: 30px;">
          <p style="font-size: 1.1em; margin-bottom: 20px; max-width: 600px; margin-left: auto; margin-right: auto; font-family: 'Libre Baskerville', serif; color: var(--dark-parchment);">
            Join up to 8 players in this hilarious party game where you create the most outrageous conspiracy theories about your campaign characters and vote for the best ones!
          </p>
        </div>
        <button class="game-btn" onclick="showHostLobby()">🎮 Host Game</button>
        <button class="game-btn" onclick="showJoinScreen()">📱 Join Game</button>
      </div>

      <!-- Screen 2: Join Screen -->
      <div id="join-screen" class="screen">
        <div class="screen-header">
          <div class="screen-title">Join a Game</div>
          <div class="screen-subtitle">Enter the room code to join your friends</div>
        </div>
        <input type="text" id="room-code" class="input-field" placeholder="Enter Room Code" maxlength="4" style="text-transform: uppercase;">
        <br>
        <input type="text" id="player-name" class="input-field" placeholder="Enter Your Name" maxlength="20">
        <br>
        <button class="game-btn" onclick="joinGame()">Join Game</button>
        <button class="game-btn" onclick="showHomeScreen()">Back</button>
        <div id="join-error" class="error-message" style="display: none;"></div>
      </div>

      <!-- Screen 3: Game Lobby -->
      <div id="lobby-screen" class="screen">
        <div class="screen-header">
          <div class="screen-title">Game Lobby</div>
          <div class="screen-subtitle" id="lobby-subtitle">Waiting for players to join...</div>
        </div>
        
        <!-- Host View -->
        <div id="host-lobby-content" style="display: none;">
          <div class="lobby-code" id="lobby-code">ABCD</div>
          <p style="margin: 10px 0; font-family: 'Libre Baskerville', serif; color: var(--dark-parchment);">Share this code with players or send them this link:<br>
          <strong id="game-url" style="color: var(--gold);">Loading...</strong></p>
        </div>
        
        <!-- Player View -->
        <div id="player-lobby-content" style="display: none;">
          <div class="status-message">
            <p><strong>Room Code:</strong> <span id="player-room-code"></span></p>
            <p><strong>Your Name:</strong> <span id="player-display-name"></span></p>
          </div>
        </div>
        
        <div class="players-list">
          <h3>Players in Game (<span id="lobby-player-count">0</span>):</h3>
          <div id="players-container">
            <p style="color: var(--stone-gray); font-family: 'Libre Baskerville', serif;">Waiting for players to join...</p>
          </div>
        </div>
        
        <button class="game-btn" onclick="startGame()" id="start-game-btn" style="display: none;">Start Game</button>
        <button class="game-btn" onclick="showHomeScreen()">Leave Game</button>
      </div>

      <!-- Screen 4: Writing Phase -->
      <div id="writing-screen" class="screen">
        <div class="screen-header">
          <div class="screen-title">Round <span id="current-round">1</span> of 4</div>
          <div class="screen-subtitle">Write your conspiracy theory!</div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" id="game-progress" style="width: 25%;"></div>
        </div>
        
        <div class="prompt-display" id="writing-prompt">Loading prompt...</div>
        
        <div class="timer" id="writing-timer">60</div>
        
        <!-- Host View -->
        <div id="host-writing-content" style="display: none;">
          <div class="status-message">
            <p><span class="waiting-indicator">⏳</span> Players are writing their theories...</p>
            <p><strong>Submitted:</strong> <span id="submitted-count">0</span>/<span id="total-players">0</span></p>
          </div>
          <button class="game-btn" onclick="skipTimer()">Skip Timer ⏭️</button>
        </div>
        
        <!-- Player View -->
        <div id="player-writing-content" style="display: none;">
          <div class="mobile-input">
            <textarea id="conspiracy-input" placeholder="Write your conspiracy theory here... Be creative and funny!"></textarea>
            <br>
            <button class="game-btn" onclick="submitConspiracy()" id="submit-btn">Submit Theory</button>
          </div>
        </div>
      </div>

      <!-- Screen 5: Voting Phase -->
      <div id="voting-screen" class="screen">
        <div class="screen-header">
          <div class="screen-title" id="voting-screen-title">Vote for the Best Theory!</div>
          <div class="screen-subtitle" id="voting-screen-subtitle">Choose your favorite conspiracy (you can't vote for your own)</div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" id="voting-progress" style="width: 50%;"></div>
        </div>
        
        <div class="answers-grid" id="voting-answers-grid"></div>
        
        <!-- Host View -->
        <div id="host-voting-content" style="display: none;">
          <div class="status-message">
            <p><span class="waiting-indicator">⏳</span> Players are voting for their favorite theories...</p>
            <p><strong>Voted:</strong> <span id="host-voted-count">0</span>/<span id="host-total-players-voting">0</span></p>
          </div>
          <button class="game-btn" onclick="skipTimer()">Skip Voting ⏭️</button>
        </div>
        
        <!-- Player View -->
        <div id="player-voting-content" style="display: none;">
          <div class="status-message" id="voting-status">
            <p><span class="waiting-indicator">⏳</span> Waiting for all players to vote...</p>
            <p><strong>Voted:</strong> <span id="voted-count">0</span>/<span id="total-players-voting">0</span></p>
          </div>
        </div>
      </div>

      <!-- Screen 6: Vote Results -->
      <div id="vote-results-screen" class="screen">
        <div class="screen-header">
          <div class="screen-title">Round Results</div>
          <div class="screen-subtitle">See how everyone voted!</div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" id="results-progress" style="width: 75%;"></div>
        </div>
        
        <div class="answers-grid" id="vote-results-grid"></div>
        
        <!-- Host controls -->
        <div id="host-results-controls" style="display: none;">
          <button class="game-btn" onclick="showCurrentScores()" id="show-scores-btn">Show Scores 📊</button>
        </div>
        
        <!-- Player waiting -->
        <div id="player-results-waiting" style="display: none;">
          <div class="status-message">
            <p><span class="waiting-indicator">⏳</span> Waiting for next round...</p>
          </div>
        </div>
      </div>

      <!-- Screen 7: Current Scores -->
      <div id="current-scores-screen" class="screen">
        <div class="screen-header">
          <div class="screen-title">Current Scores</div>
          <div class="screen-subtitle">After Round <span id="scores-round">1</span></div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" id="scores-progress" style="width: 75%;"></div>
        </div>
        
        <div class="scoreboard" id="current-scoreboard"></div>
        
        <div id="host-scores-controls" style="display: none;">
          <button class="game-btn" id="continue-game-btn" onclick="continueGame()">Continue Game ➡️</button>
        </div>
        
        <div id="player-scores-waiting" style="display: none;">
          <div class="status-message">
            <p><span class="waiting-indicator">⏳</span> Get ready for the next round...</p>
          </div>
        </div>
      </div>

      <!-- Screen 8: Final Results -->
      <div id="final-results-screen" class="screen">
        <div class="screen-header">
          <div class="screen-title">🏆 Final Results 🏆</div>
          <div class="screen-subtitle">Game Over - Here's who won!</div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" style="width: 100%;"></div>
        </div>
        
        <div class="scoreboard" id="final-scoreboard"></div>
        
        <div class="status-message">
          <p>Thanks for playing! 🎉</p>
          <p>Want to play another round?</p>
        </div>
        
        <button class="game-btn" onclick="resetGame()">🎮 New Game</button>
        <button class="game-btn" onclick="showHomeScreen()">Main Menu</button>
      </div>
    </div>
  </div>

  <footer><div class="container small">© <span id="y"></span> Braeden Pope</div></footer>
  <script src="script.js"></script>
  <script>document.getElementById('y').textContent=new Date().getFullYear()</script>
  
  <!-- Socket.io will be loaded from CDN since we can't use the /socket.io/ path in a static site -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // Audio System - Only plays for host
    const gameAudio = {
      backgroundMusic: new Audio('assets/medieval-ambient.mp3'),
      votingMusic: new Audio('assets/tense-voting.mp3'),
      resultsMusic: new Audio('assets/celebration.mp3'),
      
      // Sound effects
      joinSound: new Audio('assets/join-game.mp3'),
      submitSound: new Audio('assets/submit-theory.mp3'),
      voteSound: new Audio('assets/vote-cast.mp3'),
      
      currentTrack: null,
      isMuted: false,
      volume: 0.5,
      
      init() {
        // Set up background music to loop
        this.backgroundMusic.loop = true;
        this.backgroundMusic.volume = this.volume * 0.2;
        this.votingMusic.loop = true;
        this.votingMusic.volume = this.volume * 0.2;
        this.resultsMusic.loop = false;
        this.resultsMusic.volume = this.volume * 0.2;
        
        // Lower volume for sound effects
        this.joinSound.volume = this.volume * 0.3;
        this.submitSound.volume = this.volume * 0.3;
        this.voteSound.volume = this.volume * 0.3;
      },
      
      playMusic(track) {
        // Only play audio if user is host
        if (!gameState.isHost) return;
        
        // Stop current music
        if (this.currentTrack && !this.currentTrack.paused) {
          this.currentTrack.pause();
          this.currentTrack.currentTime = 0;
        }
        
        // Start new track
        this.currentTrack = this[track];
        if (!this.isMuted) {
          this.currentTrack.play().catch(e => console.log('Audio play failed:', e));
        }
      },
      
      playSound(soundName) {
        // Only play audio if user is host
        if (!gameState.isHost || this.isMuted) return;
        
        const sound = this[soundName];
        sound.currentTime = 0; // Reset to start
        sound.play().catch(e => console.log('Sound play failed:', e));
      },
      
      stopAll() {
        Object.values(this).forEach(audio => {
          if (audio instanceof Audio && !audio.paused) {
            audio.pause();
            audio.currentTime = 0;
          }
        });
        this.currentTrack = null;
      },
      
      setVolume(volume) {
        this.volume = volume;
        this.backgroundMusic.volume = volume * 0.3;
        this.votingMusic.volume = volume * 0.4;
        this.resultsMusic.volume = volume * 0.5;
        this.joinSound.volume = volume * 0.6;
        this.submitSound.volume = volume * 0.6;
        this.voteSound.volume = volume * 0.6;
      },
      
      mute() {
        this.isMuted = true;
        this.stopAll();
      },
      
      unmute() {
        this.isMuted = false;
      }
    };

    let socket;
    let gameState = {
      isHost: false,
      lobbyCode: '',
      playerName: '',
      playerId: '',
      currentRound: 1,
      maxRounds: 4,
      currentPrompt: '',
      hasSubmitted: false,
      hasVoted: false,
      connected: false,
      playerNames: new Map(),
      runningScores: new Map()
    };

    // Audio control functions
    function toggleMute() {
      const muteBtn = document.getElementById('mute-btn');
      if (gameAudio.isMuted) {
        gameAudio.unmute();
        muteBtn.textContent = '🔊';
      } else {
        gameAudio.mute();
        muteBtn.textContent = '🔇';
      }
    }

    function setGameVolume(volume) {
      gameAudio.setVolume(parseFloat(volume));
    }

    function showAudioControls() {
      if (gameState.isHost) {
        document.getElementById('audio-controls').classList.add('show');
      }
    }

    function hideAudioControls() {
      document.getElementById('audio-controls').classList.remove('show');
    }

    // Initialize socket connection
    function initSocket() {
      // Replace this URL with your deployed server URL
      const serverUrl = 'https://portfolio-quge.onrender.com'; // Change this!
      socket = io(serverUrl);
      
      socket.on('connect', () => {
        console.log('Connected to server');
        gameState.connected = true;
        gameState.playerId = socket.id;
        hideError();
        
        // Initialize audio system after connection
        gameAudio.init();
      });

      socket.on('disconnect', () => {
        console.log('Disconnected from server');
        gameState.connected = false;
        gameAudio.stopAll();
      });

      // Game events
      socket.on('gameCreated', ({ code }) => {
        console.log('Game created with code:', code);
        gameState.lobbyCode = code;
        
        // Make sure we update the display
        const lobbyCodeElement = document.getElementById('lobby-code');
        if (lobbyCodeElement) {
          lobbyCodeElement.textContent = code;
        }
        
        document.getElementById('game-url').textContent = window.location.origin + '/conspiracy-game.html';
        updateStartButton(0); // Start with 0 players
        hideTransition();
        
        // Play background music for host
        gameAudio.playMusic('backgroundMusic');

        // Show audio controls for host
        showAudioControls();
      });

      socket.on('joinedGame', ({ code }) => {
        console.log('Successfully joined game:', code);
        gameState.lobbyCode = code;
        document.getElementById('player-room-code').textContent = code;
        document.getElementById('player-display-name').textContent = gameState.playerName;
        showPlayerLobby();
        hideError();
        
        // Play join sound for host
        gameAudio.playSound('joinSound');
      });

      socket.on('playersUpdate', ({ players }) => {
        // Store player names for later use in scoring
        players.forEach(player => {
          gameState.playerNames.set(player.id, player.name);
        });
        
        updatePlayersDisplay(players);
        updateStartButton(players.length);
        
        // Play join sound for host when new player joins
        if (gameState.isHost && players.length > 0) {
          gameAudio.playSound('joinSound');
        }
      });

      socket.on('roundStart', ({ round, prompt, timeLeft }) => {
        gameState.currentRound = round;
        gameState.currentPrompt = prompt;
        gameState.hasSubmitted = false;
        gameState.hasVoted = false;
        
        document.getElementById('current-round').textContent = round;
        document.getElementById('writing-prompt').textContent = prompt;
        
        showWritingScreen();
        updateTimer(timeLeft);
        
        // Play background music for host
        gameAudio.playMusic('backgroundMusic');
      });

      socket.on('timerUpdate', ({ timeLeft }) => {
        updateTimer(timeLeft);
      });

      socket.on('submissionUpdate', ({ submitted, total }) => {
        document.getElementById('submitted-count').textContent = submitted;
        document.getElementById('total-players').textContent = total;
        
        // Play submit sound for host when someone submits
        if (gameState.isHost) {
          gameAudio.playSound('submitSound');
        }
      });

      socket.on('votingPhase', ({ submissions }) => {
        showVotingScreen();
        displayAnswersForVoting(submissions);
        
        // Play voting music for host
        gameAudio.playMusic('votingMusic');
      });

      socket.on('voteUpdate', ({ voted, total }) => {
        // Update both host and player vote counters
        document.getElementById('voted-count').textContent = voted;
        document.getElementById('total-players-voting').textContent = total;
        document.getElementById('host-voted-count').textContent = voted;
        document.getElementById('host-total-players-voting').textContent = total;
        
        // Play vote sound for host when someone votes
        if (gameState.isHost) {
          gameAudio.playSound('voteSound');
        }
      });

      socket.on('results', ({ results, isLastRound }) => {
        // Store player names from results
        results.forEach(result => {
          if (result.playerName) {
            gameState.playerNames.set(result.id, result.playerName);
          }
        });
        
        showVoteResultsScreen();
        displayVoteResults(results);
        gameState.isLastRound = isLastRound;
        
        // Play results music for host
        gameAudio.playMusic('resultsMusic');
      });

      socket.on('finalResults', ({ scores }) => {
        showFinalResultsScreen();
        displayFinalResults(scores);
        
        // Play celebration music for host
        gameAudio.playMusic('resultsMusic');
      });

      socket.on('theorySubmitted', () => {
        const submitBtn = document.getElementById('submit-btn');
        submitBtn.textContent = '✅ Theory Submitted!';
        submitBtn.classList.add('success');
        submitBtn.disabled = true;
        document.getElementById('conspiracy-input').disabled = true;
        gameState.hasSubmitted = true;
      });

      socket.on('voteRegistered', () => {
        // Only show vote confirmation to players, not host
        if (!gameState.isHost) {
          const statusDiv = document.getElementById('voting-status');
          statusDiv.style.display = 'block';
          statusDiv.innerHTML = '✅ Your vote has been registered!';
        }
        gameState.hasVoted = true;
      });

      socket.on('error', (message) => {
        showError(message);
        console.error('Game error:', message);
      });
    }

    // Enhanced screen transition system
    function showScreen(screenId, transitionText = '') {
      // Show transition overlay if text provided
      if (transitionText) {
        showTransition(transitionText);
        setTimeout(() => {
          performScreenTransition(screenId);
          hideTransition();
        }, 800);
      } else {
        performScreenTransition(screenId);
      }
    }

    function performScreenTransition(screenId) {
      const currentScreen = document.querySelector('.screen.active');
      const newScreen = document.getElementById(screenId);
      
      if (currentScreen) {
        currentScreen.classList.remove('active');
        currentScreen.classList.add('exiting');
        setTimeout(() => {
          currentScreen.classList.remove('exiting');
        }, 400);
      }
      
      if (newScreen) {
        newScreen.classList.add('active');
      }
    }

    function showTransition(text) {
      const overlay = document.getElementById('transition-overlay');
      const textElement = document.getElementById('transition-text');
      textElement.textContent = text;
      overlay.classList.add('active');
    }

    function hideTransition() {
      const overlay = document.getElementById('transition-overlay');
      overlay.classList.remove('active');
    }

    function updateProgressBar(stage) {
      const progressBars = {
        'writing': 25,
        'voting': 50,
        'results': 75,
        'final': 100
      };
      
      ['game-progress', 'voting-progress', 'results-progress', 'scores-progress'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.style.width = (progressBars[stage] || 0) + '%';
        }
      });
    }

    // Screen navigation functions
    function showHomeScreen() {
      showScreen('home-screen');
      if (socket && socket.connected) {
        socket.disconnect();
      }
      resetGameState();
      hideAudioControls();
      gameAudio.stopAll();
    }

    function showJoinScreen() {
      showScreen('join-screen');
    }

    function showHostLobby() {
      gameState.isHost = true;
      // Clear any previous lobby code
      document.getElementById('lobby-code').textContent = 'LOADING...';
      
      initSocket();
      showScreen('lobby-screen', 'Creating game...');
      
      // Show host content
      document.getElementById('host-lobby-content').style.display = 'block';
      document.getElementById('player-lobby-content').style.display = 'none';
      document.getElementById('start-game-btn').style.display = 'block';
      document.getElementById('lobby-subtitle').textContent = 'Share the room code with your friends';
      
      // Wait for socket connection before creating game
      const waitForConnection = () => {
        if (gameState.connected) {
          console.log('Socket connected, creating game...');
          socket.emit('createGame');
        } else {
          setTimeout(waitForConnection, 100);
        }
      };
      waitForConnection();
    }

    function showPlayerLobby() {
      showScreen('lobby-screen', 'Joining game...');
      
      // Show player content
      document.getElementById('host-lobby-content').style.display = 'none';
      document.getElementById('player-lobby-content').style.display = 'block';
      document.getElementById('start-game-btn').style.display = 'none';
      document.getElementById('lobby-subtitle').textContent = 'Waiting for host to start the game';
    }

    function showWritingScreen() {
      showScreen('writing-screen', 'Get ready to write...');
      updateProgressBar('writing');
      
      if (gameState.isHost) {
        document.getElementById('host-writing-content').style.display = 'block';
        document.getElementById('player-writing-content').style.display = 'none';
      } else {
        document.getElementById('host-writing-content').style.display = 'none';
        document.getElementById('player-writing-content').style.display = 'block';
        resetWritingInterface();
      }
    }

    function showVotingScreen() {
      showScreen('voting-screen', 'Time to vote!');
      updateProgressBar('voting');
      
      if (gameState.isHost) {
        // Host view - just watching
        document.getElementById('voting-screen-title').textContent = 'Players Are Voting';
        document.getElementById('voting-screen-subtitle').textContent = 'Watch as players choose their favorite theories';
        document.getElementById('host-voting-content').style.display = 'block';
        document.getElementById('player-voting-content').style.display = 'none';
      } else {
        // Player view - can vote
        document.getElementById('voting-screen-title').textContent = 'Vote for the Best Theory!';
        document.getElementById('voting-screen-subtitle').textContent = 'Choose your favorite conspiracy (you can\'t vote for your own)';
        document.getElementById('host-voting-content').style.display = 'none';
        document.getElementById('player-voting-content').style.display = 'block';
      }
    }

    function showVoteResultsScreen() {
      showScreen('vote-results-screen', 'Counting votes...');
      updateProgressBar('results');
      
      if (gameState.isHost) {
        document.getElementById('host-results-controls').style.display = 'block';
        document.getElementById('player-results-waiting').style.display = 'none';
      } else {
        document.getElementById('host-results-controls').style.display = 'none';
        document.getElementById('player-results-waiting').style.display = 'block';
      }
    }

    function showCurrentScores() {
      showScreen('current-scores-screen', 'Calculating scores...');
      
      document.getElementById('scores-round').textContent = gameState.currentRound;
      
      if (gameState.isHost) {
        document.getElementById('host-scores-controls').style.display = 'block';
        document.getElementById('player-scores-waiting').style.display = 'none';
        
        // Update button text based on if it's the last round
        const continueBtn = document.getElementById('continue-game-btn');
        if (gameState.currentRound >= gameState.maxRounds) {
          continueBtn.textContent = 'Show Final Results 🏆';
          continueBtn.onclick = () => socket.emit('nextRound', { code: gameState.lobbyCode });
        } else {
          continueBtn.textContent = `Start Round ${gameState.currentRound + 1} ➡️`;
          continueBtn.onclick = continueGame;
        }
      } else {
        document.getElementById('host-scores-controls').style.display = 'none';
        document.getElementById('player-scores-waiting').style.display = 'block';
      }
    }

    function showFinalResultsScreen() {
      showScreen('final-results-screen', 'Game complete!');
      updateProgressBar('final');
    }

    function continueGame() {
      if (gameState.connected && gameState.lobbyCode) {
        socket.emit('nextRound', { code: gameState.lobbyCode });
      }
    }

    function resetGameState() {
      gameState = {
        isHost: false,
        lobbyCode: '',
        playerName: '',
        playerId: '',
        currentRound: 1,
        maxRounds: 4,
        currentPrompt: '',
        hasSubmitted: false,
        hasVoted: false,
        connected: false,
        playerNames: new Map(),
        runningScores: new Map()
      };
    }

    function showError(message) {
      const errorDiv = document.getElementById('join-error');
      if (errorDiv) {
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
      }
    }

    function hideError() {
      const errorDiv = document.getElementById('join-error');
      if (errorDiv) {
        errorDiv.style.display = 'none';
      }
    }

    // Host functions
    function showHostView() {
      gameState.isHost = true;
      showScreen('host-view');
      showHostScreen('host-lobby');
      initSocket();
    }

    function startGame() {
      if (gameState.connected && gameState.lobbyCode) {
        socket.emit('startGame', { code: gameState.lobbyCode });
      } else {
        showError('Not connected to server or no game created');
      }
    }

    function nextRound() {
      if (gameState.connected && gameState.lobbyCode) {
        socket.emit('nextRound', { code: gameState.lobbyCode });
      }
    }

    function skipTimer() {
      if (gameState.connected && gameState.lobbyCode) {
        socket.emit('skipTimer', { code: gameState.lobbyCode });
      }
    }

    function resetGame() {
      showHostLobby();
    }

    // Player functions
    function joinGame() {
      const code = document.getElementById('room-code').value.toUpperCase().trim();
      const name = document.getElementById('player-name').value.trim();
      
      console.log('Attempting to join game:', { code, name });
      
      if (!code || !name) {
        showError('Please enter both room code and your name!');
        return;
      }
      
      if (code.length !== 4) {
        showError('Room code must be exactly 4 characters!');
        return;
      }
      
      if (name.length > 20) {
        showError('Name must be 20 characters or less!');
        return;
      }
      
      gameState.playerName = name;
      gameState.isHost = false;
      
      // Show loading state
      showTransition('Joining game...');
      
      initSocket();
      
      // Wait for socket connection before joining
      const waitForConnection = () => {
        if (gameState.connected) {
          console.log('Socket connected, attempting to join...');
          socket.emit('joinGame', { code, name });
        } else {
          console.log('Waiting for socket connection...');
          setTimeout(waitForConnection, 100);
        }
      };
      waitForConnection();
    }

    function resetWritingInterface() {
      const input = document.getElementById('conspiracy-input');
      const btn = document.getElementById('submit-btn');
      
      input.value = '';
      input.disabled = false;
      btn.disabled = false;
      btn.textContent = 'Submit Theory';
      btn.classList.remove('success');
    }

    function submitConspiracy() {
      const theory = document.getElementById('conspiracy-input').value.trim();
      if (!theory) {
        alert('Please write a conspiracy theory!');
        return;
      }
      
      if (gameState.connected && gameState.lobbyCode) {
        socket.emit('submitTheory', { code: gameState.lobbyCode, theory });
      }
    }

    function voteForAnswer(playerId) {
      // Prevent host from voting
      if (gameState.isHost) {
        return;
      }
      
      if (gameState.hasVoted || playerId === gameState.playerId) {
        return;
      }
      
      if (gameState.connected && gameState.lobbyCode) {
        socket.emit('vote', { code: gameState.lobbyCode, votedForId: playerId });
        
        // Update UI immediately
        document.querySelectorAll('.answer-item[data-id]').forEach(el => {
          el.classList.remove('voted');
          el.classList.add('non-clickable');
          el.onclick = null;
        });
        
        const votedElement = document.querySelector(`[data-id="${playerId}"]`);
        if (votedElement) {
          votedElement.classList.add('voted');
        }
      }
    }

    // Enhanced display functions
    function updatePlayersDisplay(players = []) {
      const container = document.getElementById('players-container');
      const countElement = document.getElementById('lobby-player-count');
      
      if (players.length === 0) {
        container.innerHTML = '<p style="color: var(--stone-gray); font-family: \'Libre Baskerville\', serif;">Waiting for players to join...</p>';
      } else {
        const playerElements = players.map(player => 
          `<div class="player-item">${player.name}</div>`
        ).join('');
        container.innerHTML = playerElements;
      }
      
      if (countElement) countElement.textContent = players.length;
    }

    function updateStartButton(playerCount = 0) {
      const startBtn = document.getElementById('start-game-btn');
      if (gameState.isHost && startBtn) {
        if (playerCount >= 1) {
          startBtn.disabled = false;
          startBtn.textContent = `Start Game (${playerCount} player${playerCount !== 1 ? 's' : ''})`;
        } else {
          startBtn.disabled = true;
          startBtn.textContent = 'Waiting for players...';
        }
      }
    }

    function updateTimer(timeLeft) {
      const timerElement = document.getElementById('writing-timer');
      
      if (timerElement) {
        timerElement.textContent = timeLeft;
        if (timeLeft <= 10) {
          timerElement.classList.add('warning');
        } else {
          timerElement.classList.remove('warning');
        }
      }
    }

    function displayAnswersForVoting(submissions) {
      const grid = document.getElementById('voting-answers-grid');
      
      if (gameState.isHost) {
        // Host view - just display theories, no voting
        const hostHTML = submissions.map(sub => 
          `<div class="answer-item non-clickable">
            <div style="font-size: 1.1em;">${sub.text}</div>
            <div style="font-style: italic; color: var(--gold); margin-top: 10px; font-family: 'Cinzel', serif;">by ${sub.playerName}</div>
          </div>`
        ).join('');
        
        if (grid) grid.innerHTML = hostHTML;
      } else {
        // Player view - can vote (original logic)
        const playerHTML = submissions.map(sub => {
          const isOwnTheory = sub.id === gameState.playerId;
          const clickHandler = isOwnTheory ? '' : `onclick="voteForAnswer('${sub.id}')"`;
          const className = isOwnTheory ? 'answer-item non-clickable' : 'answer-item';
          const ownTheoryLabel = isOwnTheory ? '<div style="color: var(--forest-green); font-weight: bold; margin-bottom: 5px; font-family: \'Cinzel\', serif;">Your Theory</div>' : '';
          
          return `<div class="${className}" ${clickHandler} data-id="${sub.id}">
            ${ownTheoryLabel}
            <div style="font-size: 1.1em;">${sub.text}</div>
          </div>`;
        }).join('');
        
        if (grid) grid.innerHTML = playerHTML;
      }
    }

    function displayVoteResults(results) {
      const grid = document.getElementById('vote-results-grid');
      
      const resultsHTML = results.map(result => 
        `<div class="answer-item non-clickable">
          <div style="font-size: 1.1em; margin-bottom: 10px;">${result.text}</div>
          <div style="font-style: italic; color: var(--gold); margin-bottom: 10px; font-family: 'Cinzel', serif;">by ${result.playerName}</div>
          <div class="vote-count">${result.votes} vote${result.votes !== 1 ? 's' : ''} ${result.votes > 0 ? '🎉' : ''}</div>
        </div>`
      ).join('');
      
      if (grid) grid.innerHTML = resultsHTML;
      
      // Create current scores after showing vote results
      setTimeout(() => {
        if (gameState.isHost) {
          calculateCurrentScores(results);
        }
      }, 2000);
    }

    function calculateCurrentScores(results) {
      // Initialize running scores if not exists
      if (!gameState.runningScores) {
        gameState.runningScores = new Map();
      }
      
      // Calculate scores based on votes received
      const scoreUpdates = new Map();
      results.forEach(result => {
        scoreUpdates.set(result.id, result.votes);
        // Also store player name if we have it
        if (result.playerName) {
          gameState.playerNames.set(result.id, result.playerName);
        }
      });
      
      // Update running totals
      scoreUpdates.forEach((votes, playerId) => {
        const currentScore = gameState.runningScores.get(playerId) || 0;
        gameState.runningScores.set(playerId, currentScore + votes);
      });
      
      // Display current scores
      displayCurrentScores();
    }

    function displayCurrentScores() {
      const scoreboard = document.getElementById('current-scoreboard');
      
      if (!gameState.runningScores) return;
      
      const scores = Array.from(gameState.runningScores.entries()).map(([id, score]) => {
        const playerName = gameState.playerNames.get(id) || 'Unknown Player';
        return { id, name: playerName, score };
      }).sort((a, b) => b.score - a.score);
      
      const scoreboardHTML = scores.map((player, index) => {
        const isLeading = index === 0 && player.score > 0;
        const className = isLeading ? 'score-item winner' : 'score-item';
        
        return `<div class="${className}">
          <div class="score-name">
            ${isLeading ? '👑 ' : ''}${player.name}
            ${isLeading ? ' - Leading!' : ''}
          </div>
          <div class="score-points">${player.score} point${player.score !== 1 ? 's' : ''}</div>
        </div>`;
      }).join('');
      
      if (scoreboard) scoreboard.innerHTML = scoreboardHTML;
    }

    function displayFinalResults(scores) {
      const scoreboard = document.getElementById('final-scoreboard');
      
      const scoreboardHTML = scores.map((player, index) => {
        const isWinner = index === 0;
        const className = isWinner ? 'score-item winner' : 'score-item';
        
        return `<div class="${className}">
          <div class="score-name">
            ${isWinner ? '🏆 ' : ''}${player.name}
            ${isWinner ? ' - WINNER!' : ''}
          </div>
          <div class="score-points">${player.score} point${player.score !== 1 ? 's' : ''}</div>
        </div>`;
      }).join('');
      
      if (scoreboard) scoreboard.innerHTML = scoreboardHTML;
    }

    // Auto-uppercase room code input
    document.addEventListener('DOMContentLoaded', () => {
      const roomCodeInput = document.getElementById('room-code');
      if (roomCodeInput) {
        roomCodeInput.addEventListener('input', (e) => {
          e.target.value = e.target.value.toUpperCase();
        });
      }
      
      // Initialize audio system
      gameAudio.init();
    });
  </script>
</body>
</html>